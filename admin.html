<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Results Viewer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const ResultsViewer = () => {
          const [stats, setStats] = useState({
            champion: 0,
            collaborative: 0,
            defensive: 0,
            avoider: 0,
            shifter: 0
          });
          const [totalParticipants, setTotalParticipants] = useState(0);
          const [loading, setLoading] = useState(false);

          const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwXgnv9EPeFFUa15SAcuUWCEhuG6StKbA_KKU7cL2hjoHAsx6qW_EAsjiDeFbdR8AjVFQ/exec';

          const accountabilityTypes = {
            champion: {
              title: "The Ownership Champion",
              color: "bg-green-500",
              icon: "ðŸ†"
            },
            collaborative: {
              title: "The Collaborative Fixer",
              color: "bg-blue-500",
              icon: "ðŸ¤"
            },
            defensive: {
              title: "The Defensive Deflector",
              color: "bg-yellow-500",
              icon: "ðŸ›¡ï¸"
            },
            avoider: {
              title: "The Silent Avoider",
              color: "bg-orange-500",
              icon: "ðŸ™ˆ"
            },
            shifter: {
              title: "The Blame Shifter",
              color: "bg-red-500",
              icon: "âž¡ï¸"
            }
          };

          const loadResults = async () => {
            setLoading(true);
            try {
              const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getStats');
              const data = await response.json();
              
              if (data.stats) {
                setStats(data.stats);
                setTotalParticipants(data.total);
              }
            } catch (error) {
              console.error('Error loading results:', error);
            }
            setLoading(false);
          };

          useEffect(() => {
            loadResults();
          }, []);

          const maxCount = Math.max(...Object.values(stats));
          const mostCommonType = Object.keys(stats).find(key => stats[key] === maxCount);

          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6">
              <div className="max-w-6xl mx-auto">
                <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                  <div className="flex items-center justify-between">
                    <div>
                      <h1 className="text-3xl font-bold text-gray-800 mb-2">
                        Accountability Quiz Results
                      </h1>
                      <p className="text-gray-600">
                        Live anonymous results from your team
                      </p>
                    </div>
                    <button
                      onClick={loadResults}
                      disabled={loading}
                      className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:bg-gray-400"
                    >
                      <span className={loading ? 'animate-spin' : ''}>ðŸ”„</span>
                      Refresh
                    </button>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-gray-600 text-sm font-medium">Total Responses</p>
                        <p className="text-4xl font-bold text-gray-800 mt-2">{totalParticipants}</p>
                      </div>
                      <div className="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                        <span className="text-2xl">ðŸ‘¥</span>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-gray-600 text-sm font-medium">Most Common Type</p>
                        <p className="text-2xl font-bold text-gray-800 mt-2">
                          {maxCount > 0 && mostCommonType ? accountabilityTypes[mostCommonType]?.icon : '-'}
                        </p>
                        <p className="text-xs text-gray-500 mt-1">
                          {maxCount > 0 && mostCommonType ? accountabilityTypes[mostCommonType]?.title : 'No data yet'}
                        </p>
                      </div>
                      <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <span className="text-2xl">ðŸ“ˆ</span>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-gray-600 text-sm font-medium">Response Rate</p>
                        <p className="text-4xl font-bold text-gray-800 mt-2">
                          {totalParticipants > 0 ? '100%' : '0%'}
                        </p>
                      </div>
                      <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <span className="text-2xl">ðŸ“Š</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-2xl shadow-xl p-8">
                  <div className="flex items-center gap-2 mb-8">
                    <span className="text-2xl">ðŸ“Š</span>
                    <h2 className="text-2xl font-bold text-gray-800">
                      Accountability Type Distribution
                    </h2>
                  </div>
                  
                  {totalParticipants === 0 ? (
                    <div className="text-center py-12">
                      <div className="text-6xl mb-4">ðŸ“Š</div>
                      <p className="text-gray-600 text-lg">Waiting for responses...</p>
                      <p className="text-gray-500 text-sm mt-2">Results will appear here as people complete the quiz</p>
                    </div>
                  ) : (
                    <div className="space-y-6">
                      {Object.entries(accountabilityTypes).map(([key, type]) => {
                        const count = stats[key] || 0;
                        const percentage = totalParticipants > 0 ? (count / totalParticipants * 100).toFixed(1) : 0;
                        
                        return (
                          <div key={key} className="space-y-3">
                            <div className="flex items-center justify-between">
                              <div className="flex items-center gap-3">
                                <span className="text-3xl">{type.icon}</span>
                                <div>
                                  <p className="font-semibold text-gray-800 text-lg">{type.title}</p>
                                  <p className="text-sm text-gray-500">{count} people ({percentage}%)</p>
                                </div>
                              </div>
                              <div className="text-right">
                                <p className="text-2xl font-bold text-gray-800">{count}</p>
                              </div>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-4">
                              <div
                                className={`${type.color} h-4 rounded-full transition-all duration-500 flex items-center justify-end pr-3`}
                                style={{ width: `${percentage}%` }}
                              >
                                {percentage > 10 && (
                                  <span className="text-white text-xs font-semibold">{percentage}%</span>
                                )}
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  )}
                </div>

                <div className="bg-blue-50 border border-blue-200 rounded-xl p-6 mt-6">
                  <h3 className="font-semibold text-blue-900 mb-2">ðŸ“± For Screen Sharing:</h3>
                  <ul className="text-sm text-blue-800 space-y-1">
                    <li>â€¢ Share this screen with your meeting participants</li>
                    <li>â€¢ Click "Refresh" to update with latest responses</li>
                    <li>â€¢ All results are completely anonymous - no names are stored</li>
                  </ul>
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ResultsViewer />);
    </script>
</body>
</html>

